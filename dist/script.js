"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();Array.from||(Array.from=function(){var e=Object.prototype.toString,r=function(r){return"function"==typeof r||"[object Function]"===e.call(r)},t=function(e){var r=Number(e);return isNaN(r)?0:0!==r&&isFinite(r)?(r>0?1:-1)*Math.floor(Math.abs(r)):r},n=Math.pow(2,53)-1,a=function(e){var r=t(e);return Math.min(Math.max(r,0),n)};return function(e){var t=this,n=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var o,s=arguments.length>1?arguments[1]:void 0;if("undefined"!=typeof s){if(!r(s))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(o=arguments[2])}for(var c,i=a(n.length),u=r(t)?Object(new t(i)):new Array(i),l=0;i>l;)c=n[l],s?u[l]="undefined"==typeof o?s(c,l):s.call(o,c,l):u[l]=c,l+=1;return u.length=i,u}}());var parseTextNodes=function(e,r){var t=function n(){var t=arguments.length<=0||void 0===arguments[0]?e:arguments[0];[].concat(_toConsumableArray(t.childNodes)).forEach(n),t.nodeType===Node.TEXT_NODE&&""!==t.nodeValue&&r(t)};return t},Watcher=function(){function e(r){var t=this;_classCallCheck(this,e),this.parsers=[],this.container=r,this.observer=new MutationObserver(function(e){return t.defaultParser(e)}).observe(r,{childList:!0,subtree:!0})}return _createClass(e,[{key:"defaultParser",value:function(e){var r=this;e.forEach(function(e){return r.force(e.addedNodes)})}},{key:"addParser",value:function(e,r){this.parsers.push(e),r&&this.force(r)}},{key:"force",value:function(e){var r=this;[].concat(_toConsumableArray(e)).forEach(function(e){return e.classList&&r.parsers.forEach(function(r){return r(e)})})}}]),e}(),watcher=new Watcher(chat),userColorSheet=document.createElement("style"),foundColorUsers=[];document.head.appendChild(userColorSheet);var hashCode=function(e){var r=0;e+="!salty";for(var t=0;t<e.length;t++)r=e.charCodeAt(t)+((r<<5)-r);return r},colorCode=function(e){var r=Math.abs(e)%360;return"hsl("+r+", 50%, 50%)"},writeToSheet=function(e){userColorSheet.textContent+=".user-"+e.key+" .messages { border-top: solid .25em "+e.color+" !important; } "},colorUserParser=function(e){if(e.classList.contains("user-container")){var r=e.querySelector("a.signature");if(!r)return;var t=r.getAttribute("href").split("/")[2];-1===foundColorUsers.indexOf(t)&&(foundColorUsers.push(t),writeToSheet({key:t,color:colorCode(hashCode(t))}))}};watcher.addParser(colorUserParser,document.querySelectorAll(".user-container"));var visualHexParser=function(e){e.classList.contains("message")&&!e.classList.contains("pending")&&!function(){var r=/\B#(?:[0-9a-f]{3}){1,2}\b/gi;parseTextNodes(e,function(t){if(r.test(t.textContent)){var n=document.createElement("span"),a=t.textContent.match(/\B#(?:[0-9a-f]{3}){1,2}\b/gi);n.style.borderBottom="solid 3px "+a[0],n.textContent=e.textContent,t.parentNode.replaceChild(n,t)}})()}()};watcher.addParser(visualHexParser,document.querySelectorAll(".user-container .message"));var webmOneboxParser=function(e){if(e.classList.contains("message")&&!e.classList.contains("pending")){var r=e.querySelector(".content");if(r.childNodes.length>1)return;var t=r.querySelector("a");if(!t||!/(webm|gifv)$/.test(t.href))return;var n=document.createElement("video");n.controls=!0,n.src=t.href.replace(/(gifv)$/,"webm"),n.width=320,n.height=240,r.replaceChild(n,t)}};watcher.addParser(webmOneboxParser,document.querySelectorAll(".user-container .message"));